[回到首页](../README.md)

# 缓存

缓存机制的一些概念和问题

[TOC]

## 1、缓存分类

### 1.1、PHP缓存

1、opcache，将编译后的字节码缓存下来，下次就不需要编译

2、yac内存缓存

3、file文件缓存，框架中一般自己会封装

### 1.2、Nginx缓存

### 1.3、浏览器缓存

## 2、缓存常见问题

### 2.1、缓存穿透

概念：数据库不存在的数据不会被缓存，访问这个数据则每次都会查数据库，给数据库带来压力

解决方案：

1、提高缓存命中率

2、校验前置，过滤非法请求

3、空值防范：查询数据库发现数据不存在时也缓存，设置较短的过期时间（比如60s）

4、

### 2.2、缓存雪崩

概念：当过期时间设置为固定时长时，集中生成的缓存会集中过期，过期后会对后端产生压力

解决方案：尽可能分散缓存过期时间，比如同类商品缓存不同周期，同类商品也加上一个随机因子，热门商品缓存时间长一些，冷门商品缓存时间短一些。

### 2.3、缓存击穿

概念：缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。

解决方案：

1、让爆款商品永不过期

2、数据预载：提前将热数据加载至缓存

3、低俗存储器防护：

3.1、过载防护：对于超出处理能力的请求进行拦截

3.2、熔断机制：在数据请求接入层基于拦截响应判断是否需要在上层进行拦截

3.3、消息队列：流量削峰，避免对数据库的高并发查询

> 参考：
>
> 1、[缓存击穿解决方案浅析 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/113432713)
>
> 2、[实例解读什么是Redis缓存穿透、缓存雪崩和缓存击穿 (baidu.com)](https://baijiahao.baidu.com/s?id=1619572269435584821&wfr=spider&for=pc)

